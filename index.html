<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Availability Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { width: 100%; height: 80vh; }
    .bubble div {
      border-radius: 50%;
      text-align: center;
      font-weight: bold;
      color: white;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>

<div id="map"></div>

<script>
const dataUrl = 'https://mgfrv.github.io/mfg-heatmap/map.json';

const regionCoords = {
  "California":[36.7783,-119.4179],
  "Texas":[31.9686,-99.9018],
  "Florida":[27.6648,-81.5158],
  "New York":[43,-75],
  "Illinois":[40,-89],
  "Pennsylvania":[41.2033,-77.1945],
  "Ohio":[40.4173,-82.9071],
  "Georgia":[32.1656,-82.9001]
};

const map = L.map('map').setView([39.8283,-98.5795],4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:18,
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let markers = [];

function render(rows) {
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  const counts = {};

  rows.forEach(r => {
    if (!r.available) return;
    counts[r.region] = (counts[r.region] || 0) + 1;
  });

  Object.entries(counts).forEach(([region, count]) => {
    if (!regionCoords[region]) return;

    const [lat, lon] = regionCoords[region];
    const size = 20 + count * 3;

    const icon = L.divIcon({
      className: 'bubble',
      html: `<div style="
        width:${size}px;
        height:${size}px;
        line-height:${size}px;
        font-size:${10 + count}px;
        background: red;
      ">${count}</div>`,
      iconSize: [size, size],
      iconAnchor: [size/2, size/2]
    });

    const marker = L.marker([lat, lon], { icon })
      .bindTooltip(region + ': ' + count + ' companies');

    markers.push(marker.addTo(map));
  });
}

fetch(dataUrl)
  .then(r => r.json())
  .then(rows => render(rows));
</script>

</body>
</html>
